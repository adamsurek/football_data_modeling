{{-
	config(
		materialized='incremental',
		unique_key='sk'
	)
-}}

{%- set source_table = source('nflverse', 'play_by_play') -%}
{%- set date_column = 'dts_loaded' -%}
{%- set pk_columns = [
    'game_id',
    'play_id',
] -%}
{%- set data_columns = [
    'game_id',
    'play_id',
    'order_sequence',
    'season',
    'posteam',
    'defteam',
    'game_seconds_remaining',
    'game_half',
    'half_seconds_remaining',
    'qtr',
    'quarter_seconds_remaining',
    'time',
    'quarter_end',
    'home_timeouts_remaining',
    'away_timeouts_remaining',
    'posteam_score',
    'defteam_score',
    'posteam_score_post',
    'defteam_score_post',
    'drive',
    'drive_play_id_started',
    'drive_play_id_ended',
    'drive_real_start_time',
    'series',
    'series_success',
    'series_result',
    'down',
    'ydstogo',
    'goal_to_go',
    'side_of_field',
    'yrdln',
    'yardline_100',
    'ydsnet',
    'play_type',
    'sp',
    '"desc"',
    'yards_gained',
    'passer_player_id',
    'shotgun',
    'no_huddle',
    'qb_dropback',
    'qb_spike',
    'qb_scramble',
    'qb_hit',
    'qb_hit_1_player_id',
    'qb_hit_2_player_id',
    'sack',
    'sack_player_id',
    'half_sack_1_player_id',
    'half_sack_2_player_id',
    'complete_pass',
    'incomplete_pass',
    'cp',
    'cpoe',
    'pass_location',
    'air_yards',
    'receiver_player_id',
    'yards_after_catch',
    'interception',
    'interception_player_id',
    'rusher_player_id',
    'run_location',
    'run_gap',
    'tackled_for_loss',
    'touchdown',
    'td_team',
    'td_player_id',
    'third_down_converted',
    'third_down_failed',
    'fourth_down_converted',
    'fourth_down_failed',
    'extra_point_attempt',
    'extra_point_result',
    'field_goal_attempt',
    'field_goal_result',
    'two_point_attempt',
    'two_point_conv_result',
    'replay_or_challenge',
    'replay_or_challenge_result',
    'kickoff_attempt',
    'kickoff_out_of_bounds',
    'kickoff_downed',
    'kickoff_fair_catch',
    'kicker_player_id',
    'kickoff_returner_player_id',
    'punt_attempt',
    'blocked_player_id',
    'punt_blocked',
    'punt_out_of_bounds',
    'punt_downed',
    'punt_fair_catch',
    'punter_player_id',
    'punt_returner_player_id',
    'kick_distance',
    'return_team',
    'return_yards',
    'touchback',
    'aborted_play',
    'timeout',
    'timeout_team',
    'penalty',
	'penalty_player_id',
	'penalty_team',
	'penalty_type',
	'penalty_yards',
    'safety',
    'safety_player_id',
    'no_score_prob',
    'fg_prob',
    'td_prob',
    'extra_point_prob',
    'two_point_conversion_prob',
    'safety_prob',
    'opp_fg_prob',
    'opp_safety_prob',
    'opp_td_prob',
    'ep',
    'epa',
    'total_home_epa',
    'total_away_epa',
    'total_home_rush_epa',
    'total_away_rush_epa',
    'total_home_pass_epa',
    'total_away_pass_epa',
    'air_epa',
    'yac_epa',
    'comp_air_epa',
    'comp_yac_epa',
    'total_home_comp_air_epa',
    'total_away_comp_air_epa',
    'total_home_comp_yac_epa',
    'total_away_comp_yac_epa',
    'total_home_raw_air_epa',
    'total_away_raw_air_epa',
    'total_home_raw_yac_epa',
    'total_away_raw_yac_epa',
    'wp',
    'def_wp',
    'home_wp',
    'away_wp',
    'wpa',
    'home_wp_post',
    'away_wp_post',
    'total_home_rush_wpa',
    'total_away_rush_wpa',
    'total_home_pass_wpa',
    'total_away_pass_wpa',
    'air_wpa',
    'yac_wpa',
    'comp_air_wpa',
    'comp_yac_wpa',
    'total_home_comp_air_wpa',
    'total_away_comp_air_wpa',
    'total_home_comp_yac_wpa',
    'total_away_comp_yac_wpa',
    'total_home_raw_air_wpa',
    'total_away_raw_air_wpa',
    'total_home_raw_yac_wpa',
    'total_away_raw_yac_wpa',
    'solo_tackle',
    'assist_tackle',
    'pass_defense_1_player_id',
    'pass_defense_2_player_id',
    'tackle_for_loss_1_player_id',
    'tackle_for_loss_2_player_id',
    'solo_tackle_1_team',
    'solo_tackle_1_player_id',
    'solo_tackle_2_team',
    'solo_tackle_2_player_id',
    'assist_tackle_1_team',
    'assist_tackle_1_player_id',
    'assist_tackle_2_team',
    'assist_tackle_2_player_id',
    'assist_tackle_3_team',
    'assist_tackle_3_player_id',
    'assist_tackle_4_team',
    'assist_tackle_4_player_id',
    'tackle_with_assist',
    'tackle_with_assist_1_team',
    'tackle_with_assist_1_player_id',
    'tackle_with_assist_2_team',
    'tackle_with_assist_2_player_id',
    'fumble',
    'fumble_lost',
    'fumble_forced',
    'fumble_not_forced',
    'fumble_out_of_bounds',
    'fumbled_1_player_id',
    'fumbled_1_team',
    'fumbled_2_player_id',
    'fumbled_2_team',
    'fumble_recovery_1_player_id',
    'fumble_recovery_1_team',
    'fumble_recovery_1_yards',
    'fumble_recovery_2_player_id',
    'fumble_recovery_2_team',
    'fumble_recovery_2_yards',
    'forced_fumble_player_1_team',
    'forced_fumble_player_1_player_id',
    'forced_fumble_player_2_team',
    'forced_fumble_player_2_player_id',
    'lateral_reception',
    'lateral_receiver_player_id',
    'lateral_rush',
    'lateral_rusher_player_id',
    'lateral_return',
    'lateral_recovery',
    'lateral_sack_player_id',
    'lateral_interception_player_id',
    'lateral_punt_returner_player_id',
    'lateral_kickoff_returner_player_id',
    'own_kickoff_recovery_player_id',
    'own_kickoff_recovery',
    'own_kickoff_recovery_td',
    'defensive_two_point_attempt',
    'defensive_two_point_conv',
    'defensive_extra_point_attempt',
    'defensive_extra_point_conv',
] -%}

{%- set pre_filter = """""" -%}

{{ standard_scd_2_hist(
    this=this,
    source_table=source_table,
    is_incremental=is_incremental(),
    date_column=date_column,
    pk_columns=pk_columns,
    data_columns=data_columns,
    pre_filter=pre_filter
) }}
